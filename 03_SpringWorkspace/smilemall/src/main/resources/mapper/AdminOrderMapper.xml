<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.smilemall.basic.admin.order.AdminOrderMapper">

	<!-- 검색조건 : 상품명, 제조사, 내용-->
	<sql id="criteria">
		<trim prefix="(" suffix=")AND" prefixOverrides="OR">
			<foreach collection="typeArr" item="type">
				<trim prefix="OR">
					<choose>
						<when test="type == 'N'.toString()">
							ord_name like '%' || #{keyword} || '%'
						</when>
						<when test="type == 'C'.toString()">
							ord_code like '%' || #{keyword} || '%'
						</when>
						<when test="type == 'I'.toString()">
							mbsp_id like '%' || #{keyword} || '%'
						</when>
					</choose>
				</trim>
			</foreach>
		</trim>
	</sql>


	<!-- [상품리스트] -->
	<select id="ord_list" parameterType="Criteria" resultType="OrderVo">
		SELECT
			ord_code, 
			mbsp_id, 
			ord_name, 
			ord_tel, 
			ord_regdate, 
			ord_addr_zipcode, 
			ord_addr_basic, 
			ord_addr_detail, 
			ord_price, 
			ord_desc, 
			ord_admin_meno
		FROM (
			SELECT
				/*+ INDEX_DESC (order_tbl PK_ORD_CODE)*/
				ROWNUM AS RN, 
					ord_code, 
					mbsp_id, 
					ord_name, 
					ord_tel, 
					ord_regdate, 
					ord_addr_zipcode, 
					ord_addr_basic, 
					ord_addr_detail, 
					ord_price, 
					ord_desc, 
					ord_admin_meno
			FROM
				order_tbl
			WHERE
				<include refid="criteria"></include>
				<![CDATA[
					ROWNUM <= (#{pageNum} * #{amount})
				]]>
			)
		WHERE
			RN > (#{pageNum} - 1) * #{amount}
	</select>	

	<!-- [전체 데이터 갯수]  -->
	<select id="getTotalCount" resultType="int">
		SELECT
			COUNT(*)
		FROM
			order_tbl
		WHERE
			<include refid="criteria"></include> 
			ord_code > 0 		<!-- 사용자가 검색기능을 사용하지 않았을때 where절까지만 작성되고 끊기므로 해당 조건 기입. 
									 해당 조건 사용시 include문이 생성되지 않아도 에러가 발생하지 않음. -->
	</select>

</mapper>